<!-- HEADER -->
<div align="center">
  <div style="width:500px; border:5px dotted black; border-radius: 25px;">
    <h1 align="center">gcloud-movie-picker</h1>
    <p align="center">Need help picking a movie to watch?</p>
    <p align="center">
      <a href="https://hendrick-cis655-finalproject.ue.r.appspot.com/">
        <img src="https://img.shields.io/badge/Click_here_to_use_application!-blue?style=for-the-badge&">
      </a>
      <a href="https://www.youtube.com/">
        <img src="https://img.shields.io/badge/Presentation-red?style=for-the-badge&logo=youtube">
      </a>
    </p>
  </div>
</div>



<!-- TABLE OF CONTENTS -->
## Table of Contents
<ol>
  <li>
    <a href="#about-the-project">About The Project</a>
  </li>
  <li>
    <a href="#instructions">Instructions</a>
    <ul>
      <li><a href="#cloud-storage">Cloud Storage</a></li>
      <li><a href="#big-query">Big Query</a></li>
      <li><a href="#vertex-ai">Vertex AI</a></li>
      <li><a href="#cloud-run">Cloud Run</a></li>
      <li><a href="#app-engine">App Engine</a></li>
    </ul>
  </li>
  <li><a href="#usage">Usage</a></li>
</ol>



<!-- ABOUT THE PROJECT -->
## About The Project

I have always loved watching movies, but always seem to have trouble deciding which film to watch, or sometimes even simply finding a film that peaks my interest. This tool implements a machine learning model, trained with user ratings using Vertex AI, to generate recommended movies based on those provided by a user.



<!-- GETTING STARTED -->
## Instructions

This project implements Google Cloud services, specifically Cloud Storage, Big Query, Vertex AI, Cloud Run, and App Engine. For recreation purposes, this is a brief description of how each was implemented.

This also means a Google Cloud account is required, since all instructions are meant for use within the Cloud Console (using these services may incur charges to your account).

### Cloud Storage

The data needed for training the Vertex AI model was stored within Cloud Storage, which was done with the following commands (make sure you are in the same directory as the .csv files when executing):

```sh
gcloud storage buckets create gs://{PROJECT_ID}-recommended-movies-bucket
```
```sh
gcloud storage cp movies.csv ratings.csv gs://{PROJECT_ID}-recommended-movies-bucket
```

The datasets were initially downloaded from [Kaggle - MovieLens 20M Dataset](https://www.kaggle.com/datasets/grouplens/movielens-20m-dataset), and uploaded to the Cloud Console. For convenience, the files are also stored in this repository.

**IMPORTANT:** The web application also makes a call directly to Cloud Storage, allowing the user to download the movie dataset. In order for this call to work properly, the bucket permissions must be updated. In the permissions tab of the recommended-movies-bucket details within Cloud Console, grant the "Storage Object Viewer" role to the principal "allUsers".

### Big Query

### Vertex AI

### Cloud Run

A Cloud Run function was developed using Python ([main.py](cloud_funcs/main.py)) to invoke the Vertex AI model and generate predicted movies using input from the user. The model identifies movies by custom ID, not title, so the program searches the database for the closest title match given the user input and invokes the model with the associated ID.

To deploy this function to Cloud Run, use the command:
```sh
gcloud functions deploy movie_recommender --gen2 --region=us-east1 --runtime=python39 --source=. --entry-point=http_movie_recommender --trigger-http
```

Use a cURL command to ensure the function is working properly, the response should include the recommended movies in JSON format (make sure to replace {GENERATED_CLOUD_RUN_URL} with the URL generated by the deploy command). Feel free to edit the input movies to see different reponses.
```sh
curl -X POST {GENERATED_CLOUD_RUN_URL} -H "Content-Type: application/json" -d '{"movies":["Inception","The Dark Knight","Shrek"]}'
```

### App Engine

App Engine was used for hosting the web application. NodeJS and HTML were used to develop the application; make sure you install npm before trying to run the application:

```sh
npm install
```

For testing purposes, the web server can be ran locally to view the effect of any changes quickly using this command (make sure to run within the web-app subdirectory):

```sh
npm start
```

For deploying the application to App Engine, use the command (make sure to run within the web-app subdirectory):

```sh
gcloud app deploy
```

The application should now be ready to use! Access using the URL generated from the previous command.



<!-- USAGE EXAMPLES -->
## Usage

The application itself should be self explanatory. The user has the option to input up to five of their movies, and clicking "Submit" will generate their top three recommended movies based on a Vertex AI model. It is important to note that that dataset being used is older and will only recognize movies released in 2015 or earlier.

The user also has the option of downloading the movie dataset (in the form of a .txt file) by clicking "Download Dataset." This dataset includes the list of movies and the genres associated with each.

![Usage](screenshots/usage.png)